11/7(월) - 주말을 너무 공허하게 보냈어.. 


프레임마다 뽑아온 애니메 행렬들을 보간해줄 차례인가
보간 -> 뽑아온 행렬을 srt로 분해해서 계산하고 다시 곱할?듯? 
Q : 근데 그냥 분해도 안하고 중간값으로 다 때려버리면 안됨? 이상하게 나오나?

dxMath에서 행렬 분해하는 기능이 지원이 된다, 엥;
D3DMatixDecompose 이걸로 srt로 분리가 된다,, 원리는요; 이쯤되면 원리따윈 사실 필요없는건가 굳
암튼 저렇게 뽑아온 srt를 보정을 해서 다시곱해줘야겠죠? 근데 그전에 부모 월드행렬 역행렬 곱해놔야 안카나

제어행렬? 애니메이션 행렬이 따로 있고, 제어 행렬이 따로 있다. 그 두개가 결합이 된게 월드행렬 -> 지금은 일단 넘어간?듯?
(제자리서 춤추는거 -> 애니메, 이동하는거 -> 제어 라는 느낌?)

오브젝트 클래스에다가 함수를 하나 만들고 보간을 여기서 할것이다
로테이션은 쿼터니언으로,, 
암튼 srt 다 보간해주고 난 후엔 다시 행렬로 만들어서 곱해줘야 할 것, 근데 t는 그냥 41 42 43에 직접 넣어버림

선형 보간도 라이브러리에 있는 함수로 해버린다 (D3DXVec3Lerp, D3DXQuaternionSlerp)
보간한 사원수는 또 행렬로 만들어야 할것, 이것도 라이브러리에 있는 함수로

아니 근데 보간해놓은 행렬은 뭐 인잇하면서 오브젝트에 저장해놓는건가? 아니면 프레임에서? 언제 만들고 어디에 저장하며 언제 뽑아오는겨?
근데 어째 결과는 잘 돌아가네?? 느리게 해도 부드럽게 가는디? 
Q : 그 뭐시기 부모행렬 역행렬 곱했다가 그거는 위에서 해놓은겨 아니면 안해도 되는겨; -> 지금은 안해도 되는듯..? 근데 캐릭터 할때는 해줘야 할것이다

보간해야할 놈들만 추려서 따로 리스트를 들고있지 않으면 그렇게 큰 소득이 아니다 (실시간으로 if달아서 비교하는건 딱히..)
근데 뭐 오브젝트 자체가 애니메이션이 있는지 없는지 검사하는 정도는 수지 맞는 장사가 될수있다

근데 지금은 부모와의 상속 뭐시기가 전혀 고려되고 있지 않다, 위에 Q 참고.. 나중에 캐릭터 애니메이션 할때는 필히 고려해야 할 것
-> 오 2교시에 하시려나? 그치그치 부모꺼srt 내꺼srt 두개 보간해서 곱해줘야하는데 지금은 부모꺼*내꺼 srt를 보간하고있응께
프레임과 프레임 사이니까 지금은 무시할만한 정도의 차이..

월드 행렬이랑 애니메이션 행렬을 분리를 할 필요성이 좀 있다




이제부터 문서를 쪼꼼 보러감, 캐릭터 애니메이션으로 넘어갑니다 (86장)
가중치..? 가중치라는 값이 1이었다 라는걸 기억해야한다..
하나의 정점에 하나의 행렬만 곱해지는게 아니다.......?
스키닝 -> 수학적?으로 보면, 하나의 정점에 행렬이 여러개 곱해지는 것 (캐릭터에서는 보통 4개가 사용이 된다)
블렌딩 방식? -> 하나 이상의 행렬이 곱해지는것.. 
이런식으로 하면 하나의 팔 오브젝트에서 팔 근육 부분만 빵빵해졌다가 그럴수도 있다
아무튼 모든 가중치의 합은 1이다 
특정 뼈대의 영향력을 30프로 받고, 또 다른 뼈대의 영향력을 50프로 받고 대충 이런식
다른 오브젝트의 영향을 받아서 내가 움직인다 (ex - 왼팔을 높이 들면 모가지가 젖혀지고 머 이런거)

스키닝을 하려면 정점마다 영향을 미치는 행렬이 몇개인지, 그게 어떤 행렬인지, 가중치가 얼마인지 찾아야댐



코딩을 결국엔 또 해주시넹, 암튼
지금 오브젝트 애니메이션도 스키닝 형식으로 돌아가게끔 바까볼거
상수버퍼를 하나를 더쓸거다, 뼈대? 행렬들 넣어놓는듯
정점성분에 행렬 인덱스랑 가중치도 추가 -> PNCTIW;; 
가 아니라 그냥 IW를 따로추가
상수버퍼도 매트릭스 255개 들어가는걸로 하나 추가 (BONE머시기)
->여까지가 베이스오브젝트(라이브러리?)에서 건드린 부분,

버퍼 두개를 믹스해서? 버텍스 쉐이더에 넘길것이다?
0번버퍼 1번버퍼 ㄷㄷ 
아무튼 크리에이트 레이아웃도 갖고와서 재정의해주고

크리에이트 버텍스버퍼도 갖고와서 원래껀 그대로만들고 IW버텍스버퍼도 새로 만들어줌

렌더에서는 좀 많은 부분이 달라져야함, ㅓ,,,졸려,,,, 스키닝오브젝트그냥또봐ㅏ,,,

FBX로더에서도 좀 손봐주고 


암튼 저시기 새로운 상수버퍼에다가 행렬들 넘겨주는건 오후에 (ㅋ ㅋㅋ ㅋㅋㅋ)



메쉬가 없는것들도 프레임에서 애니메이션 연산은 해야한다 (ex-헬퍼 오브젝트)
지금 렌더에서 메쉬 있는놈들만 대충 연산하고 있는데, 사실 프레임에서 싹다 돌리고 렌더에선 안하는게 맞다
FbxLoader를 FbxFile로 이름 바까버림, 로더는 매니저마냥 밖으로빼시나?아닌가? 아하 파일안에로더가있다라고생각을해야한다 
모든 오브젝트마다 ID를 부여하겠다 (UINT로 인덱스를 달거다, iObjectBone이라는이름으로)

헤더는 하나지만 cpp는 여러개 만들어 놓을거다? ㄷㄷ 로더/애니메이션/파일 

하나의 Fbx 파일에는 하나의 애니메이션만 존재한다, 오브젝트마다 행렬만 다를뿐 (애니메이션 트랙만 다르다)
->그래서 로드애니메이션에서 그.. 암튼 초반부에 저거 다 들어낸 버전으로 하나 만든다 (Init애니메) 아씨발 또 그거 데자뷰 느꼈어; 뭐지 진짜
암튼 오브젝트에 있는 파일 애니메이션 정보를 다 들어내서 파일(구 로더)에다가 저장할꺼임(애니메 씬으로), 타임모드도 끄집어냄(밑에서쓰니까)

아무튼 샘플 렌더에서 하던걸 FbxFile 프레임에서 돌리겟다
파일당 상수버퍼는 하나만 있으면 된다~ 오브젝트마다 있을 필요가없다~~ -> 그래서 파일에서 CreateConstantBuffer가 있음 편하다

상수버퍼 업데이트 근데 굳이 샘플에서? File에서 해도되는게아닌ㄴ?? 아 업데이트프레임이구나 ㅈ건 또 어디출신이래
음~ 음~~~~~ 샘플 렌더 직전에 상수버퍼만 갈아끼워준다

InterPlate에서 지금 애니메 씬 정보가 필요로 하는데 이걸 파일로 올려버려가지고 없다, 그래서 매개변수로 추가해서 받아?옴
  
로드가 성공일땐 넘어가고 실패면 지금까지 갖고온거 다 삭제하는 작업이 필요함,  근데 이건 작업을 안해놨음

그,, 뭐,, 놓친게 좀 많은디,, 아몰랑 쳐보지 뭐,,