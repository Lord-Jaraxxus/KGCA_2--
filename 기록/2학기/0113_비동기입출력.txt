1/13(금) - 빨리잔다고 컨디션이 좋지는 않지만 늦게자면 컨디션이 별로다


오늘은 이벤트 셀렉트 마저 만들고 비동기 뭐시기


패킷리스트를 유저단위로 들고있?도록 TUser에 패킷리스트를 추가 (닉네임 응답같은거 보내줄?라고)
..를 하려다가 그냥 TPacket쓰는게 나을것같아서 리스트를 TPacket리스트로 바꾸
..려다가 그냥 나중에 라이브러리 만들때 바꾸는걸로 ㅎㅎ; 

나열형 연산자는 stl뭐시기랑 궁합이 안맞아서 아무튼 함수포인터로 사용하기가 어렵다
그래서 PRINT라고 리..스트로? 아무튼 함수 새로 하나 만듬
그리고 네트워크의 멤버함수 하나를 저걸로 만들어버림ㄷㄷ 저런 방법이 (Init 부분 참고)

근데 유저리스트 삽입/삭제는 또 따로 빼셨네.. 언제 저러셨디야?
그 뭐냐 멀티쓰레드 문제때문에? 근데 멀티스레드 아니지않나 지금은? 아몰랑


우리가 지금까지 한 것 -> 동기 입출력, 비동기 통지
비동기 : 야 담배사와, 사왔으면 나한테 알려줘 이런느낌, 동기는 심부름 시키고 따라가면서 감시하는 그런
send, recv는 지금 비동기가 아닌데, 얘들도 비동기로 바꿀 것 



그래서 비동기 입출력을 하러갈거에요

Load랑 Copy라는 기능? 함수? 를? 일단 만들어놓고? 

Load 안에서 CreateFile로 파일포인터를 만든다, 읽기 전용으로 해주는 매개변수도 넣고 
GetFileSize(Ex가 붙으면 롱롱) 로 사이즈 읽어오고 (파일이 있다면)
그 사이즈만한 버퍼를 new해주고  
ReadFile로 버퍼에다가 파일을 읽어서 복?사해주고
작업 끝났으면 CloseHandle로 핸들 닫아준다 

근데 ReadFile은 블록형 함수, 즉 동기 입출력이다 (다 읽고나서 or 오류뜨면 반환함)
이런걸 다 비동기로 바꿔야함 

아무튼 다 읽히는거 확인했으니, Copy 만들러감
마찬가지로 CreateFile로 파일포인터 만듬, 여기는 쓰기 전용
WriteFile로 버퍼에 있는 데이타를 파일에 써주고


머여 논블록이랑 비동기랑은 또 다른겨?
아무튼 파일 읽는동안 아무것도 못하고 멍때려야함, 동기 입출력이니까
그래서 이번엔 진짜 비동기 입출력으로 바꾸러 감

AsyncLoad (비동기 로드) 드갑니다 
CreateFile로 파일 포인터 만들 때 매개변수로 FILE_FLAG_OVERLAPPED 이것도 준다 
ReadFile에서 마지막 매개변수에 저거.. 뭐냐.. ReadOV? 아무튼 저장을 저따가 수시로 하는건가? 
ERROR_IO_PENDING -> 읽기 중이라는 뜻
GetOverlappedResult -> 비동기 입출력의 결과를 확인하는 함수, 
근데 중간 결과를 확인해주는 게 아니라 다 됐나 아닌가만 알수있다는 한계
근데 우리는 한번에 통으로 보내는 게 아니라 짤라서 탕탕타탕탕앝앙ㅌㅇ아탕 보낼거심
그렇게 되면 이제 몇퍼센트 보냈나 이런것도 확인하기 쉬?워지겠군
ReadOV의 위에 두개는 운영체제가 관리, 우리가 손대는 게 아니다 
오프셋들은 우리가 건드릴 수 있음

AsyncCopy로 갑니다, 이것도 또옥같아여
어.. 휙휙 지나갔는데 뭐 보면 알겠지


암튼 이제 쪼개러 갑니다, 쪼개서 읽고 쪼개서 보낼거임
어.. 함수 새로 만들어요? 구분할라고인감.? 암튼 FileRead
전역변수 몇개 만들어주고 오프셋 갱신해주고, 
파일 버퍼의 포인터도 하나 만들어주고  
MaxReadSize -> 이만큼 읽겠다, 지금은 4096*4096인데 2의 승수가 좋다는것만 기억하라


몬가.. 몬가몬가인데... 음...
아무튼 쪼개서 읽고있?다는것만기억하?고있으면되겠지!

짜투리가 발목을 잡았는데,, 어케해결함?
음~ 30분 날먹 야미~
왜 문제가 생겼고 어떻게 해결하셨는지는 모르겠지만 
해결됐다는 [결과]만이 남는다 ㅅㄱ 
